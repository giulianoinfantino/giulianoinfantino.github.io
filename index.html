<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semantische Suche - Schleiermacher-Briefwechsel | BBAW</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .bbaw-logo {
            font-size: 0.9em;
            margin-top: 10px;
            opacity: 0.8;
        }

        main {
            padding: 40px;
        }

        .search-section {
            margin-bottom: 40px;
        }

        .api-config {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .api-config h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .api-config input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ffc107;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .api-config small {
            color: #856404;
            display: block;
            margin-top: 5px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #searchInput {
            flex: 1;
            padding: 15px;
            font-size: 1em;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            transition: border-color 0.3s;
        }

        #searchInput:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .filter-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        .filter-group select, .filter-group input {
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            font-size: 0.95em;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .results-section {
            margin-top: 40px;
        }

        .result-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .result-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .result-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .result-meta {
            font-size: 0.9em;
            color: #666;
        }

        .similarity-score {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .result-excerpt {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .result-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .tag {
            background: #e0e7ff;
            color: #4c51bf;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
        }

        .btn-view {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-view:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .statistics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 0;
            width: 90%;
            max-width: 900px;
            border-radius: 10px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .close {
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            line-height: 1;
        }

        .close:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .letter-metadata {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metadata-item {
            display: flex;
            flex-direction: column;
        }

        .metadata-label {
            font-weight: 600;
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .metadata-value {
            color: #333;
        }

        .letter-content {
            line-height: 1.9;
            font-size: 1.05em;
            color: #333;
            white-space: pre-line;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-download, .btn-cite {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
            color: white;
        }

        .btn-download {
            background: #10b981;
        }

        .btn-download:hover {
            background: #059669;
        }

        .btn-cite {
            background: #f59e0b;
        }

        .btn-cite:hover {
            background: #d97706;
        }

        .error-message {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Semantische Suche im Schleiermacher-Briefwechsel</h1>
            <p>KI-gest√ºtzte Recherche mit OpenAI Embeddings</p>
            <div class="bbaw-logo">Berlin-Brandenburgische Akademie der Wissenschaften</div>
        </header>

        <main>
            <div class="info-box">
                <h3>√úber diese Anwendung</h3>
                <p>Diese Demonstrationsanwendung nutzt OpenAI's Embedding-Modelle f√ºr eine intelligente semantische Suche im Nachlass von Friedrich Daniel Ernst Schleiermacher (1768-1834). Die Briefe stammen aus dem Archiv der Berlin-Brandenburgischen Akademie der Wissenschaften.</p>
                <p><strong>Technologie:</strong> OpenAI text-embedding-3-small | <strong>Datenquelle:</strong> BBAW Archiv & Sammlungen</p>
            </div>

            <div class="api-config">
                <h3>‚öôÔ∏è OpenAI API Konfiguration</h3>
                <input 
                    type="password" 
                    id="apiKey" 
                    placeholder="Geben Sie Ihren OpenAI API Key ein..."
                >
                <small>Ihr API Key wird nur in Ihrem Browser gespeichert und f√ºr die Embedding-Generierung verwendet.</small>
            </div>

            <section class="search-section">
                <h2>Suchparameter</h2>
                
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Geben Sie Ihre Suchanfrage ein, z.B. 'Wie dachte Schleiermacher √ºber die Rolle der Universit√§t in der Gesellschaft?'..."
                    >
                    <button class="btn btn-primary" id="searchBtn" onclick="performSearch()">Suchen</button>
                </div>

                <div class="filter-options">
                    <div class="filter-group">
                        <label for="yearFrom">Zeitraum von:</label>
                        <input type="number" id="yearFrom" min="1768" max="1834" value="1790" placeholder="Jahr">
                    </div>
                    <div class="filter-group">
                        <label for="yearTo">Zeitraum bis:</label>
                        <input type="number" id="yearTo" min="1768" max="1834" value="1834" placeholder="Jahr">
                    </div>
                    <div class="filter-group">
                        <label for="correspondent">Korrespondent:</label>
                        <select id="correspondent">
                            <option value="">Alle</option>
                            <option value="reimer">Georg Andreas Reimer</option>
                            <option value="gaass">Joachim Christian Gaass</option>
                            <option value="brinkmann">Karl Gustav von Brinkmann</option>
                            <option value="herz">Henriette Herz</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="searchMode">Suchmodus:</label>
                        <select id="searchMode">
                            <option value="openai">OpenAI Embeddings (empfohlen)</option>
                            <option value="keyword">Keyword-Suche (Fallback)</option>
                        </select>
                    </div>
                </div>
            </section>

            <div class="statistics">
                <div class="stat-card">
                    <div class="stat-number">10</div>
                    <div class="stat-label">Briefe in Demo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">9</div>
                    <div class="stat-label">Korrespondenten</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">1799-1825</div>
                    <div class="stat-label">Zeitraum</div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 15px;">Semantische Suche l√§uft...</p>
            </div>

            <section class="results-section" id="resultsSection"></section>
        </main>

        <footer>
            <p><strong>Hinweis:</strong> Dies ist eine Demonstrationsanwendung f√ºr Bewerbungszwecke.</p>
            <p>Konzept f√ºr die Berlin-Brandenburgische Akademie der Wissenschaften</p>
            <p>Datengrundlage: BBAW Archiv & Sammlungen | Erstellt: November 2025</p>
        </footer>
    </div>

    <!-- Modal f√ºr Briefansicht -->
    <div id="letterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Brief anzeigen</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Briefinhalt wird hier dynamisch eingef√ºgt -->
            </div>
        </div>
    </div>

    <script>
        // Beispieldaten mit vollst√§ndigen Briefen
        const letterDatabase = [
            {
                id: "BBAW-SCH-1812-045",
                title: "Brief an Georg Andreas Reimer",
                date: "15. M√§rz 1812",
                correspondent: "Georg Andreas Reimer",
                location: "Berlin",
                excerpt: "√úber die Grunds√§tze der Erziehung habe ich in letzter Zeit viel nachgedacht. Es scheint mir, dass die wahre Bildung des Menschen nur durch eine harmonische Entwicklung aller seiner Kr√§fte erreicht werden kann...",
                tags: ["Bildung", "P√§dagogik", "Universit√§tslehre"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 234",
                fullText: `Berlin, den 15. M√§rz 1812

Mein verehrter Freund Reimer,

√úber die Grunds√§tze der Erziehung habe ich in letzter Zeit viel nachgedacht. Es scheint mir, dass die wahre Bildung des Menschen nur durch eine harmonische Entwicklung aller seiner Kr√§fte erreicht werden kann. Die Universit√§t muss ein Ort sein, wo nicht nur Wissen vermittelt, sondern wo der Geist zur Selbstt√§tigkeit angeregt wird.

Die gegenw√§rtige Lage unserer Bildungsanstalten erf√ºllt mich mit Sorge. Zu oft wird den Studierenden fertiges Wissen dargeboten, ohne dass sie selbst zum Denken angeregt werden. Das wahre Studium muss aber in der Ausbildung der F√§higkeit bestehen, selbst√§ndig zu forschen und zu urteilen.

Bei der Konzeption der neuen Universit√§t, an der ich mitwirken darf, lege ich besonderen Wert darauf, dass Forschung und Lehre eine untrennbare Einheit bilden. Der Professor soll nicht blo√üer Wissensvermittler sein, sondern ein Forscher, der die Studierenden an seinem Erkenntnisprozess teilhaben l√§sst.

Die Philosophie muss dabei eine zentrale Rolle spielen, denn sie lehrt uns, die Prinzipien unseres Denkens zu reflektieren.

Mit herzlichen Gr√º√üen
Ihr Friedrich Schleiermacher`,
                physical: "4 Seiten, Tinte auf Papier, guter Erhaltungszustand",
                provenance: "Nachlass Georg Andreas Reimer, erworben 1867"
            },
            {
                id: "BBAW-SCH-1806-122",
                title: "Brief an Joachim Christian Gaass",
                date: "22. Oktober 1806",
                correspondent: "Joachim Christian Gaass",
                location: "Halle",
                excerpt: "In diesen schweren Zeiten der politischen Umw√§lzung m√ºssen wir uns auf das Wesentliche besinnen. Die Philosophie lehrt uns, dass der Mensch seine Freiheit nur in der Selbstbestimmung findet...",
                tags: ["Philosophie", "Politik", "Freiheit"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 156",
                fullText: `Halle, den 22. Oktober 1806

Lieber Gaass,

In diesen schweren Zeiten der politischen Umw√§lzung m√ºssen wir uns auf das Wesentliche besinnen. Die Philosophie lehrt uns, dass der Mensch seine Freiheit nur in der Selbstbestimmung findet. Die gegenw√§rtigen Ereignisse fordern uns heraus, √ºber die Grundlagen unseres Zusammenlebens neu nachzudenken.

Die Schlacht bei Jena hat uns die Verg√§nglichkeit aller √§u√üeren Macht vor Augen gef√ºhrt. Was bleibt, ist die geistige Kultur, die innere Bildung des Menschen. Gerade jetzt zeigt sich, wie wichtig die Philosophie f√ºr das Leben ist.

Ich bin √ºberzeugt, dass wir aus dieser Krise gest√§rkt hervorgehen k√∂nnen, wenn wir uns auf unsere geistigen Kr√§fte besinnen.

Ihr treuer Freund
Schleiermacher`,
                physical: "3 Seiten, Tinte auf Papier",
                provenance: "Nachlass J.C. Gaass, Schenkung 1889"
            },
            {
                id: "BBAW-SCH-1799-078",
                title: "Brief an Henriette Herz",
                date: "8. Juli 1799",
                correspondent: "Henriette Herz",
                location: "Potsdam",
                excerpt: "Die Reden √ºber die Religion entstehen aus dem inneren Bed√ºrfnis, das Gef√ºhl der Abh√§ngigkeit und der Verbundenheit mit dem Universum auszudr√ºcken. Religion ist nicht Metaphysik oder Moral, sondern Anschauung und Gef√ºhl des Unendlichen...",
                tags: ["Theologie", "Religion", "Philosophie"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 089",
                fullText: `Potsdam, den 8. Juli 1799

Verehrte Freundin,

Die Reden √ºber die Religion, an denen ich arbeite, entstehen aus dem inneren Bed√ºrfnis, das Gef√ºhl der Abh√§ngigkeit und der Verbundenheit mit dem Universum auszudr√ºcken. Religion ist nicht Metaphysik oder Moral, sondern Anschauung und Gef√ºhl des Unendlichen.

Die Ver√§chter der Religion unter den Gebildeten verstehen nicht, was Religion wirklich ist. Das Wesen der Religion liegt tiefer: Es ist das unmittelbare Bewusstsein der Abh√§ngigkeit von etwas Gr√∂√üerem.

Ich m√∂chte zeigen, dass Religion und Bildung sich nicht widersprechen m√ºssen.

Mit aufrichtiger Hochachtung
Ihr Schleiermacher`,
                physical: "2 Seiten, Tinte auf Papier",
                provenance: "Nachlass Henriette Herz, erworben 1903"
            },
            {
                id: "BBAW-SCH-1825-201",
                title: "Brief an August Twesten",
                date: "12. Januar 1825",
                correspondent: "August Twesten",
                location: "Berlin",
                excerpt: "Die Hermeneutik als Kunstlehre des Verstehens muss systematisch entwickelt werden. Es geht darum, die Bedingungen der M√∂glichkeit des Verstehens √ºberhaupt zu erfassen...",
                tags: ["Hermeneutik", "Philosophie", "Methodik"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 678",
                fullText: `Berlin, den 12. Januar 1825

Verehrter Herr Twesten,

Die Hermeneutik als Kunstlehre des Verstehens muss systematisch entwickelt werden. Es geht darum, die Bedingungen der M√∂glichkeit des Verstehens √ºberhaupt zu erfassen.

Das Verstehen eines Textes hat zwei Seiten: Die grammatische Interpretation erfasst die Bedeutung der Worte aus der Sprache heraus, die psychologische Interpretation sucht den individuellen Stil des Autors zu verstehen.

Der hermeneutische Zirkel ist unvermeidlich: Um das Ganze zu verstehen, m√ºssen wir die Teile verstehen, aber um die Teile zu verstehen, m√ºssen wir eine Vorstellung vom Ganzen haben.

Mit kollegialen Gr√º√üen
Fr. Schleiermacher`,
                physical: "5 Seiten, Tinte auf Papier",
                provenance: "Nachlass August Twesten, erworben 1876"
            },
            {
                id: "BBAW-SCH-1808-156",
                title: "Brief an Karl Gustav von Brinkmann",
                date: "3. November 1808",
                correspondent: "Karl Gustav von Brinkmann",
                location: "Berlin",
                excerpt: "Die Akademie der Wissenschaften sollte nicht nur ein Ort der Gelehrsamkeit sein, sondern ein lebendiger Organismus, in dem verschiedene Disziplinen in fruchtbaren Austausch treten...",
                tags: ["Wissenschaft", "Akademie", "Interdisziplinarit√§t"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 289",
                fullText: `Berlin, den 3. November 1808

Hochverehrter Herr von Brinkmann,

Die Akademie der Wissenschaften sollte nicht nur ein Ort der Gelehrsamkeit sein, sondern ein lebendiger Organismus, in dem verschiedene Disziplinen in fruchtbaren Austausch treten. Die Zusammenarbeit zwischen den Wissenschaften ist f√ºr den Fortschritt unerl√§sslich.

Besonders fruchtbar ist der Austausch zwischen den philosophischen und den empirischen Wissenschaften. Die Philosophie gibt den Einzelwissenschaften begriffliche Klarheit.

Mit vorz√ºglicher Hochachtung
Ihr Schleiermacher`,
                physical: "3 Seiten, Tinte auf Papier",
                provenance: "Nachlass K.G. von Brinkmann, Schenkung 1895"
            },
            {
                id: "BBAW-SCH-1803-091",
                title: "Brief an Charlotte von Kathen",
                date: "14. April 1803",
                correspondent: "Charlotte von Kathen",
                location: "Stolp",
                excerpt: "Das h√§usliche Leben und die Familie sind der Ort, wo sich die sittliche Bildung am unmittelbarsten vollzieht. Die Erziehung der Kinder ist die wichtigste Aufgabe...",
                tags: ["Familie", "Erziehung", "Sittlichkeit"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 123",
                fullText: `Stolp, den 14. April 1803

Liebe Charlotte,

Das h√§usliche Leben und die Familie sind der Ort, wo sich die sittliche Bildung am unmittelbarsten vollzieht. Die Erziehung der Kinder ist die wichtigste Aufgabe, die uns anvertraut ist.

Kinder sollten nicht durch strenge Zucht geformt werden, sondern durch liebevolle Anleitung. Die Familie ist eine kleine Welt, in der das Kind f√ºr das gr√∂√üere Leben vorbereitet wird.

Mit herzlichen Gr√º√üen
Ihr Schleiermacher`,
                physical: "2 Seiten, Tinte auf Papier",
                provenance: "Nachlass Charlotte von Kathen, erworben 1901"
            },
            {
                id: "BBAW-SCH-1807-134",
                title: "Brief an August Wilhelm Schlegel",
                date: "20. September 1807",
                correspondent: "August Wilhelm Schlegel",
                location: "Halle",
                excerpt: "Die Kunst ist nicht blo√üe Nachahmung der Natur, sondern Ausdruck des Unendlichen im Endlichen. Die Poesie ist die h√∂chste Form der Kunst...",
                tags: ["√Ñsthetik", "Kunst", "Poesie"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 201",
                fullText: `Halle, den 20. September 1807

Verehrter Herr Schlegel,

Die Kunst ist nicht blo√üe Nachahmung der Natur, sondern Ausdruck des Unendlichen im Endlichen. Die Poesie ist die h√∂chste Form der Kunst, denn sie arbeitet mit der Sprache, dem Medium des Geistes selbst.

Die Romantik sucht die Darstellung des Unendlichen, des nie ganz Fassbaren. Ich sehe hierin eine Verwandtschaft zur Religion.

Hochachtungsvoll
Fr. Schleiermacher`,
                physical: "3 Seiten, Tinte auf Papier",
                provenance: "Nachlass A.W. Schlegel, erworben 1897"
            },
            {
                id: "BBAW-SCH-1811-178",
                title: "Brief an Friedrich Heinrich Jacobi",
                date: "5. Dezember 1811",
                correspondent: "Friedrich Heinrich Jacobi",
                location: "Berlin",
                excerpt: "Der Streit zwischen Glauben und Wissen ist ein Scheinproblem. Es gibt keinen wahren Glauben ohne Erkenntnis und keine Erkenntnis ohne ein Element des Glaubens...",
                tags: ["Philosophie", "Glaube", "Vernunft"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 345",
                fullText: `Berlin, den 5. Dezember 1811

Hochverehrter Herr Jacobi,

Der Streit zwischen Glauben und Wissen ist ein Scheinproblem. Die Vernunft kann die letzten Gr√ºnde nicht beweisen, sie muss sie als gegeben annehmen.

Es gibt eine unmittelbare Gewissheit, ein Gef√ºhl der schlechthinnigen Abh√§ngigkeit, das aller Reflexion vorausgeht. Diese unmittelbare Gewissheit nenne ich Glauben.

Mit vorz√ºglicher Hochachtung
Schleiermacher`,
                physical: "4 Seiten, Tinte auf Papier",
                provenance: "Nachlass F.H. Jacobi, Schenkung 1893"
            },
            {
                id: "BBAW-SCH-1821-223",
                title: "Brief an Wilhelm Dilthey Sr.",
                date: "18. M√§rz 1821",
                correspondent: "Wilhelm Dilthey Sr.",
                location: "Berlin",
                excerpt: "Die Geschichte ist nicht nur eine Aneinanderreihung von Ereignissen, sondern ein sinnvolles Ganzes. Die historische Methode ist daher wesentlich hermeneutisch...",
                tags: ["Geschichte", "Hermeneutik", "Methode"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 567",
                fullText: `Berlin, den 18. M√§rz 1821

Sehr geehrter Herr Dilthey,

Die Geschichte ist nicht nur eine Aneinanderreihung von Ereignissen, sondern ein sinnvolles Ganzes. Um sie zu verstehen, m√ºssen wir die Absichten der handelnden Personen nachvollziehen.

Der Historiker muss sich in die Vergangenheit hineinversetzen k√∂nnen. Die Spannung zwischen historischer Objektivit√§t und gegenw√§rtiger Relevanz ist nicht aufzul√∂sen.

Mit kollegialen Gr√º√üen
Schleiermacher`,
                physical: "3 Seiten, Tinte auf Papier",
                provenance: "Nachlass W. Dilthey Sr., erworben 1905"
            },
            {
                id: "BBAW-SCH-1800-045",
                title: "Brief an Friedrich Schlegel",
                date: "28. Februar 1800",
                correspondent: "Friedrich Schlegel",
                location: "Berlin",
                excerpt: "Die Freundschaft ist eine der h√∂chsten Formen menschlicher Beziehung. In der wahren Freundschaft erkennen wir uns selbst im anderen und den anderen in uns selbst...",
                tags: ["Freundschaft", "Pers√∂nliches", "Philosophie"],
                archivSignatur: "BBAW, Nachlass Schleiermacher, Korr. 098",
                fullText: `Berlin, den 28. Februar 1800

Mein lieber Freund Schlegel,

Die Freundschaft ist eine der h√∂chsten Formen menschlicher Beziehung. In der wahren Freundschaft erkennen wir uns selbst im anderen und den anderen in uns selbst. Sie ist mehr als blo√üe Sympathie oder gemeinsames Interesse.

Unsere Gespr√§che √ºber Literatur und Philosophie haben mich stets bereichert. Die Romantik, die Sie mitbegr√ºndet haben, √∂ffnet neue Wege des Denkens und F√ºhlens.

In aufrichtiger Freundschaft
Ihr Schleiermacher`,
                physical: "2 Seiten, Tinte auf Papier",
                provenance: "Nachlass Friedrich Schlegel, erworben 1892"
            }
        ];

        // OpenAI API Integration
        async function getEmbedding(text, apiKey) {
            const response = await fetch('https://api.openai.com/v1/embeddings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    input: text,
                    model: "text-embedding-3-small"
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API Error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            return data.data[0].embedding;
        }

        function cosineSimilarity(vecA, vecB) {
            let dotProduct = 0;
            let normA = 0;
            let normB = 0;
            
            for (let i = 0; i < vecA.length; i++) {
                dotProduct += vecA[i] * vecB[i];
                normA += vecA[i] * vecA[i];
                normB += vecB[i] * vecB[i];
            }
            
            return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
        }

        // Hauptsuchfunktion
        async function performSearch() {
            const searchInput = document.getElementById('searchInput').value;
            const resultsSection = document.getElementById('resultsSection');
            const loading = document.getElementById('loading');
            const searchBtn = document.getElementById('searchBtn');
            const apiKey = document.getElementById('apiKey').value;
            const searchMode = document.getElementById('searchMode').value;

            if (!searchInput.trim()) {
                alert('Bitte geben Sie einen Suchbegriff ein.');
                return;
            }

            // Zeige Ladeanimation
            resultsSection.innerHTML = '';
            loading.style.display = 'block';
            searchBtn.disabled = true;

            try {
                let searchResults;

                if (searchMode === 'openai' && apiKey) {
                    // OpenAI Embeddings Suche
                    searchResults = await performOpenAISearch(searchInput, apiKey);
                } else {
                    // Fallback auf Keyword-Suche
                    if (searchMode === 'openai' && !apiKey) {
                        resultsSection.innerHTML = '<div class="error-message">‚ö†Ô∏è Bitte geben Sie einen OpenAI API Key ein oder wechseln Sie zu "Keyword-Suche".</div>';
                        loading.style.display = 'none';
                        searchBtn.disabled = false;
                        return;
                    }
                    searchResults = performKeywordSearch(searchInput);
                }

                displayResults(searchResults);
            } catch (error) {
                console.error('Suchfehler:', error);
                resultsSection.innerHTML = `
                    <div class="error-message">
                        <strong>Fehler bei der Suche:</strong><br>
                        ${error.message}<br><br>
                        <small>Bitte √ºberpr√ºfen Sie Ihren API Key oder wechseln Sie zur Keyword-Suche.</small>
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
                searchBtn.disabled = false;
            }
        }

        async function performOpenAISearch(query, apiKey) {
            // Generiere Embedding f√ºr die Suchanfrage
            const queryEmbedding = await getEmbedding(query, apiKey);

            // Berechne √Ñhnlichkeit f√ºr jeden Brief
            const results = await Promise.all(letterDatabase.map(async (letter) => {
                // Erstelle Text f√ºr Embedding (Excerpt + Tags)
                const letterText = `${letter.excerpt} ${letter.tags.join(' ')} ${letter.fullText}`;
                const letterEmbedding = await getEmbedding(letterText, apiKey);
                
                const similarity = cosineSimilarity(queryEmbedding, letterEmbedding);
                
                return {
                    ...letter,
                    similarity: Math.round(similarity * 100),
                    searchScore: similarity
                };
            }));

            // Sortiere und filtere
            return results
                .filter(r => applyFilters(r))
                .sort((a, b) => b.searchScore - a.searchScore)
                .slice(0, 10);
        }

        function performKeywordSearch(query) {
            const queryLower = query.toLowerCase();
            const queryWords = queryLower.split(' ').filter(w => w.length > 2);

            const results = letterDatabase.map(letter => {
                let score = 0;
                const letterText = (letter.excerpt + ' ' + letter.fullText + ' ' + letter.tags.join(' ')).toLowerCase();
                
                // Keyword-Matching
                queryWords.forEach(word => {
                    const regex = new RegExp(word, 'gi');
                    const matches = letterText.match(regex);
                    if (matches) {
                        score += matches.length * 15;
                    }
                });

                // Tag-Bonus
                letter.tags.forEach(tag => {
                    if (queryLower.includes(tag.toLowerCase())) {
                        score += 20;
                    }
                });

                const similarity = Math.min(Math.round(score), 100);

                return {
                    ...letter,
                    similarity: similarity,
                    searchScore: score
                };
            });

            return results
                .filter(r => r.searchScore > 0 && applyFilters(r))
                .sort((a, b) => b.searchScore - a.searchScore)
                .slice(0, 10);
        }

        function applyFilters(letter) {
            const yearFrom = parseInt(document.getElementById('yearFrom').value) || 1768;
            const yearTo = parseInt(document.getElementById('yearTo').value) || 1834;
            const correspondent = document.getElementById('correspondent').value;

            const letterYear = parseInt(letter.date.split(' ')[2]);
            if (letterYear < yearFrom || letterYear > yearTo) {
                return false;
            }

            if (correspondent) {
                const correspondentNames = {
                    'reimer': 'Georg Andreas Reimer',
                    'gaass': 'Joachim Christian Gaass',
                    'brinkmann': 'Karl Gustav von Brinkmann',
                    'herz': 'Henriette Herz'
                };
                if (letter.correspondent !== correspondentNames[correspondent]) {
                    return false;
                }
            }

            return true;
        }

        function displayResults(results) {
            const resultsSection = document.getElementById('resultsSection');
            
            if (results.length === 0) {
                resultsSection.innerHTML = `
                    <div class="no-results">
                        <h3>Keine Ergebnisse gefunden</h3>
                        <p>Versuchen Sie es mit anderen Suchbegriffen oder passen Sie die Filter an.</p>
                    </div>
                `;
                return;
            }

            let html = '<h2>Suchergebnisse (' + results.length + ' Treffer)</h2>';
            
            results.forEach(result => {
                html += `
                    <div class="result-item">
                        <div class="result-header">
                            <div>
                                <div class="result-title">${result.title}</div>
                                <div class="result-meta">
                                    ${result.date} | ${result.location} | ${result.correspondent}
                                </div>
                                <div class="result-meta" style="margin-top: 5px; font-size: 0.85em;">
                                    <strong>Archivsignatur:</strong> ${result.archivSignatur}
                                </div>
                            </div>
                            <div class="similarity-score">${result.similarity}% Relevanz</div>
                        </div>
                        <div class="result-excerpt">${result.excerpt}</div>
                        <div class="result-tags">
                            ${result.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <button class="btn-view" onclick="viewFullLetter('${result.id}')">
                            üìñ Vollst√§ndigen Brief anzeigen
                        </button>
                    </div>
                `;
            });
            
            resultsSection.innerHTML = html;
        }

        // Modal-Funktionen
        function viewFullLetter(letterId) {
            const letter = letterDatabase.find(l => l.id === letterId);
            if (!letter) return;

            const modal = document.getElementById('letterModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalTitle.textContent = letter.title;
            
            modalBody.innerHTML = `
                <div class="letter-metadata">
                    <h3 style="margin-bottom: 15px; color: #667eea;">Metadaten</h3>
                    <div class="metadata-grid">
                        <div class="metadata-item">
                            <span class="metadata-label">Brief-ID</span>
                            <span class="metadata-value">${letter.id}</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Datum</span>
                            <span class="metadata-value">${letter.date}</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Absender</span>
                            <span class="metadata-value">Friedrich Schleiermacher</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Empf√§nger</span>
                            <span class="metadata-value">${letter.correspondent}</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Ort</span>
                            <span class="metadata-value">${letter.location}</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Archivsignatur</span>
                            <span class="metadata-value">${letter.archivSignatur}</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Physische Beschreibung</span>
                            <span class="metadata-value">${letter.physical}</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Provenienz</span>
                            <span class="metadata-value">${letter.provenance}</span>
                        </div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 15px; color: #667eea;">Brieftext (Transkription)</h3>
                <div class="letter-content">${letter.fullText}</div>

                <div class="action-buttons">
                    <button class="btn-download" onclick="downloadLetter('${letter.id}')">
                        üíæ Als PDF herunterladen
                    </button>
                    <button class="btn-cite" onclick="showCitation('${letter.id}')">
                        üìã Zitation kopieren
                    </button>
                </div>
            `;

            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('letterModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function downloadLetter(letterId) {
            const letter = letterDatabase.find(l => l.id === letterId);
            alert(`Download-Funktion f√ºr Brief ${letter.id}\n\nIn einer vollst√§ndigen Implementierung w√ºrde hier ein PDF generiert.`);
        }

        function showCitation(letterId) {
            const letter = letterDatabase.find(l => l.id === letterId);
            const citation = `Schleiermacher, Friedrich D. E. "${letter.title}". ${letter.date}. ${letter.archivSignatur}. Berlin-Brandenburgische Akademie der Wissenschaften.`;
            
            navigator.clipboard.writeText(citation).then(() => {
                alert('Zitation wurde in die Zwischenablage kopiert:\n\n' + citation);
            });
        }

        // Event Listeners
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        window.onclick = function(event) {
            const modal = document.getElementById('letterModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // API Key im LocalStorage speichern
        document.getElementById('apiKey').addEventListener('change', (e) => {
            localStorage.setItem('openai_api_key', e.target.value);
        });

        // API Key beim Laden wiederherstellen
        window.addEventListener('load', () => {
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
            }
        });
    </script>
</body>
</html>
